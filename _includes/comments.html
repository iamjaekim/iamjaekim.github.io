{% if page.comments != false and site.comments.provider == "utterances" %}
<div class="comments-section">
  <h2 class="comments-title">Comments</h2>
  <script src="https://utteranc.es/client.js"
    repo="{{ site.comments.utterances.repo }}"
    issue-term="{{ site.comments.utterances.issue_term }}"
    {% if site.comments.utterances.label %}label="{{ site.comments.utterances.label }}"{% endif %}
    theme="github-light"
    crossorigin="anonymous"
    async>
  </script>
</div>
<script>
  // Sync utterances theme with site dark mode
  function updateUtterancesTheme(theme) {
    const iframe = document.querySelector('.utterances-frame');
    if (iframe) {
      const utterancesTheme = theme === 'dark' ? 'github-dark' : 'github-light';
      iframe.contentWindow.postMessage(
        { type: 'set-theme', theme: utterancesTheme },
        'https://utteranc.es'
      );
    }
  }
  // Listen for theme changes
  const observer = new MutationObserver(function(mutations) {
    mutations.forEach(function(mutation) {
      if (mutation.attributeName === 'data-theme') {
        updateUtterancesTheme(document.documentElement.getAttribute('data-theme'));
      }
    });
  });
  observer.observe(document.documentElement, { attributes: true });
</script>
{% endif %}
